<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Worker Dashboard - Konnect</title>
    
    <!-- BOOTSTRAP -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <style>
        :root {
            --primary-color: #4e73df;
            --success-color: #1cc88a;
            --warning-color: #f6c23e;
            --danger-color: #e74a3b;
            --bg-color: #f8f9fc;
        }

        body {
            background-color: var(--bg-color);
            font-family: 'Segoe UI', Roboto, Arial, sans-serif;
        }

        /* NAVBAR */
        .navbar {
            background: white;
            border-bottom: 1px solid #e3e6f0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        /* HEADER */
        .dashboard-header {
            background: linear-gradient(135deg, #2c3e50 0%, #4e73df 100%);
            color: white;
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(44, 62, 80, 0.2);
        }

        .profile-img-container {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid rgba(255,255,255,0.8);
        }

        .profile-img-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .status-badge {
            background: rgba(255,255,255,0.2);
            padding: 4px 14px;
            border-radius: 20px;
            backdrop-filter: blur(5px);
        }

        /* CARDS */
        .action-card {
            border: none;
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
            background: white;
            box-shadow: 0 0.15rem 1.75rem rgba(58,59,69,0.15);
            transition: 0.2s;
        }

        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0.4rem 2rem rgba(58,59,69,0.25);
        }

        .icon-box {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            font-size: 1.8rem;
        }

        .card-requests .icon-box { background: #e8f0fe; color: var(--primary-color); }
        .card-schedule .icon-box { background: #e6fffa; color: var(--success-color); }
        .card-ratings .icon-box { background: #fdf3d8; color: var(--warning-color); }
        .card-gigs .icon-box     { background: #e2e6ea; color: #5a5c69; }
        .card-job .icon-box      { background: #dbeafe; color: #2e59d9; }
        .card-emergency .icon-box { background: #fde8e8; color: var(--danger-color); }

    </style>
</head>
<body>

<!-- NAV -->
<nav class="navbar navbar-expand-lg sticky-top">
    <div class="container">
        <a class="navbar-brand fw-bold text-primary" href="#">
            <i class="bi bi-tools me-2"></i>KONNECT <span class="text-secondary">| Worker</span>
        </a>

        <a id="editProfileBtn" class="btn btn-outline-primary btn-sm rounded-pill px-3">
            <i class="bi bi-pencil-square"></i> Edit Profile
        </a>
    </div>
</nav>

<!-- BODY -->
<div class="container py-4">

    <div class="dashboard-header">
        <div class="d-flex align-items-center gap-3">

            <div class="profile-img-container">
                <img src="https://www.w3schools.com/howto/img_avatar.png" id="workerImg">
            </div>

            <div>
                <h3 class="fw-bold mb-1">Welcome, <span id="workerName">Worker</span></h3>

                <span class="status-badge">
                    <i class="bi bi-geo-alt-fill"></i>
                    <span id="workerLocation">Loading...</span>
                </span>
            </div>

        </div>
    </div>

    <div class="row g-4">

        <div class="col-md-6 col-lg-4">
            <a href="wrkrreqsee.html" class="action-card card-requests d-block">
                <div class="icon-box"><i class="bi bi-envelope-paper-fill"></i></div>
                <h5 class="fw-bold">My Requests</h5>
                <p class="text-muted small">View job offers</p>
            </a>
        </div>

        <div class="col-md-6 col-lg-4">
            <a href="myschedule.html" class="action-card card-schedule d-block">
                <div class="icon-box"><i class="bi bi-calendar-check-fill"></i></div>
                <h5 class="fw-bold">My Schedule</h5>
                <p class="text-muted small">Manage bookings</p>
            </a>
        </div>

        <div class="col-md-6 col-lg-4">
            <a id="ratingsBtn" class="action-card card-ratings d-block">
                <div class="icon-box"><i class="bi bi-star-fill"></i></div>
                <h5 class="fw-bold">My Ratings</h5>
                <p class="text-muted small">Client feedback</p>
            </a>
        </div>

        <div class="col-md-6 col-lg-4">
            <a href="mygigs.html" class="action-card card-gigs d-block">
                <div class="icon-box"><i class="bi bi-gear-wide-connected"></i></div>
                <h5 class="fw-bold">My Gigs</h5>
                <p class="text-muted small">Active services</p>
            </a>
        </div>

        <div class="col-md-6 col-lg-4">
            <a href="setjob.html" class="action-card card-job d-block">
                <div class="icon-box"><i class="bi bi-briefcase-fill"></i></div>
                <h5 class="fw-bold">Set My Job</h5>
                <p class="text-muted small">Update skills & services</p>
            </a>
        </div>

        <div class="col-md-6 col-lg-4">
            <a href="workeremergency.html" class="action-card card-emergency d-block">
                <div class="icon-box"><i class="bi bi-exclamation-triangle-fill"></i></div>
                <h5 class="fw-bold">Emergency Jobs</h5>
                <p class="text-muted small">Urgent work near you</p>
            </a>
        </div>

    </div>
</div>

<!-- FIREBASE -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCzK5umphNqLVacI8IpqLuA_1mpi0fUofU",
        authDomain: "konnect-7d7a3.firebaseapp.com",
        projectId: "konnect-7d7a3",
        storageBucket: "konnect-7d7a3.appspot.com",
        messagingSenderId: "179662401817",
        appId: "1:179662401817:web:f3faf467f5a54232eb5588"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const nameEl = document.getElementById("workerName");
    const locEl = document.getElementById("workerLocation");
    const imgEl = document.getElementById("workerImg");
    const ratingsBtn = document.getElementById("ratingsBtn");
    const editBtn = document.getElementById("editProfileBtn");

    onAuthStateChanged(auth, async (user) => {
        if (!user) {
            window.location.href = "login.html?role=worker";
            return;
        }

        const uid = user.uid;

        // âœ… FIXED: Set dynamic URLs
        ratingsBtn.href = `myraiting.html?id=${uid}`;
        editBtn.href = `edit profile.html?id=${uid}`;

        const ref = doc(db, "workers", uid);

        try {
            const snap = await getDoc(ref);
            if (snap.exists()) {
                const w = snap.data();

                nameEl.textContent = w.name || "Worker";
                locEl.textContent = w.location || "Not set";

                if (w.profileImage) {
                    imgEl.src = w.profileImage;
                }
            } else {
                nameEl.textContent = "Worker";
                locEl.textContent = "No Location";
            }
        } catch (err) {
            console.error(err);
            nameEl.textContent = "Worker";
            locEl.textContent = "Error";
        }
    });
</script>

</body>

</html>
